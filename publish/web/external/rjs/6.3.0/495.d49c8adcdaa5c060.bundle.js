(self.webpackChunkWebComponents=self.webpackChunkWebComponents||[]).push([[495],{86151:()=>{$.i18n().load({en:{msg_no_answer:"No answer provided.",msg_fitb_check_me:"Check me",msg_fitb_compare_me:"Compare me",msg_fitb_randomize:"Randomize"}})},61353:()=>{$.i18n().load({"pt-br":{msg_no_answer:"Nenhuma resposta dada.",msg_fitb_check_me:"Verificar",msg_fitb_compare_me:"Comparar"}})},63495:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>u});var r=i(2568);function n(e,t){const i=e.replaceAll(/\[%=\s*((?:.(?!%]))*)\s*%\]/g,((e,t)=>`<script-eval expr=${JSON.stringify(t)}></script-eval>`)),r=(new DOMParser).parseFromString(i,"text/html"),n=r.getElementsByTagName("script-eval");for(;n.length;){const e=n[0],i=e.getAttribute("expr");if(i){const r=window.Function("v",...Object.keys(t),`"use strict;"\nreturn ${i};`)(t,...Object.values(t));e.replaceWith(r)}}return r.body.childNodes}function s(e,t,i){const r=o(t,e,i),n=[];for(const[t,i]of Object.entries(e))n[i]=t;return[r,t.map(((e,t)=>c(n[t],e,t,i)))]}function a(e,t,i,r,s){const a=o(t,e,s),c=Object.assign({ans:t[i],ans_array:t},s,a);try{r=n(r,c)}catch(e){throw console.log(`Error evaluating feedback index ${i}.`),e}return r}function o(e,t,i){const r={};for(const[n,s]of Object.entries(t))r[n]=c(n,e[s],s,i);return r}function c(e,t,i,r){const n=r.types||d,s=n[e]||n[i]||n;s===Number&&"undefined"!=typeof Number_&&(s=Number_);try{return s(t)}catch(e){if(e instanceof TypeError)return e;throw e}}function d(e){return e}i(86151),i(61353);var l={};class h extends r.Z{constructor(e){super(e);var t=e.orig;this.useRunestoneServices=e.useRunestoneServices,this.origElem=t,this.divid=t.id,this.correct=null;const i=this.scriptSelector(this.origElem),r=JSON.parse(i.html());i.remove(),this.problemHtml=r.problemHtml,this.dyn_vars=r.dyn_vars,this.blankNames=r.blankNames,this.feedbackArray=r.feedbackArray,this.createFITBElement(),this.setupBlanks(),this.caption="Fill in the Blank",this.addCaption("runestone"),this.checkServer("fillb",!1).then((()=>{const e=void 0!==r.static_seed,t="string"==typeof this.dyn_vars,i=void 0!==this.seed;e||!t||i?e&&!t?console.log("Warning: the provided static seed was ignored, because it only affects client-side, dynamic problems."):e&&t&&!i?(this.seed=r.static_seed,this.renderDynamicContent()):e&&t&&i&&this.seed!==r.static_seed&&console.log("Warning: the provided static seed was overridden by the seed found in local storage."):this.randomize(),this.indicate_component_ready()})),"undefined"!=typeof Prism&&Prism.highlightAllUnder(this.containerDiv)}scriptSelector(e){return $(e).find('script[type="application/json"]')}createFITBElement(){this.renderFITBInput(),this.renderFITBButtons(),this.renderFITBFeedbackDiv(),$(this.origElem).replaceWith(this.containerDiv)}renderFITBInput(){this.containerDiv=document.createElement("div"),this.containerDiv.id=this.divid,this.descriptionDiv=document.createElement("div"),this.containerDiv.appendChild(this.descriptionDiv),this.problemHtml&&(this.descriptionDiv.innerHTML=this.problemHtml,this.descriptionDiv.origInnerHTML=this.problemHtml)}renderFITBButtons(){this.containerDiv.appendChild(document.createElement("br")),this.containerDiv.appendChild(document.createElement("br")),this.submitButton=document.createElement("button"),this.submitButton.textContent=$.i18n("msg_fitb_check_me"),$(this.submitButton).attr({class:"btn btn-success",name:"do answer",type:"button"}),this.submitButton.addEventListener("click",async function(){this.checkCurrentAnswer(),await this.logCurrentAnswer()}.bind(this),!1),this.containerDiv.appendChild(this.submitButton),this.useRunestoneServices&&(this.compareButton=document.createElement("button"),$(this.compareButton).attr({class:"btn btn-default",id:this.origElem.id+"_bcomp",disabled:"",name:"compare"}),this.compareButton.textContent=$.i18n("msg_fitb_compare_me"),this.compareButton.addEventListener("click",function(){this.compareFITBAnswers()}.bind(this),!1),this.containerDiv.appendChild(this.compareButton)),this.dyn_vars&&(this.randomizeButton=document.createElement("button"),$(this.randomizeButton).attr({class:"btn btn-default",id:this.origElem.id+"_bcomp",name:"randomize"}),this.randomizeButton.textContent=$.i18n("msg_fitb_randomize"),this.randomizeButton.addEventListener("click",function(){this.randomize()}.bind(this),!1),this.containerDiv.appendChild(this.randomizeButton)),this.containerDiv.appendChild(document.createElement("div"))}renderFITBFeedbackDiv(){this.feedBackDiv=document.createElement("div"),this.feedBackDiv.id=this.divid+"_feedback",this.containerDiv.appendChild(document.createElement("br")),this.containerDiv.appendChild(this.feedBackDiv)}clearFeedbackDiv(){this.feedBackDiv.innerHTML="",this.feedBackDiv.className=""}renderDynamicContent(){if("string"==typeof this.dyn_vars){let e;if([e,this.dyn_vars_eval]=function(e,t,i,r,s){const a=function(){return function(e){const t="aleaPRNG 1.1.0";var i,r,n,s,a,o=new Uint32Array(3),c="";function d(e){var t=function(){var e=4022871197,t=function(t){for(var i=0,r=(t=t.toString()).length;i<r;i++){var n=.02519603282416938*(e+=t.charCodeAt(i));n-=e=n>>>0,e=(n*=e)>>>0,e+=4294967296*(n-=e)}return 2.3283064365386963e-10*(e>>>0)};return t.version="Mash 0.9",t}();i=t(" "),r=t(" "),n=t(" "),s=1;for(var a=0;a<e.length;a++)(i-=t(e[a]))<0&&(i+=1),(r-=t(e[a]))<0&&(r+=1),(n-=t(e[a]))<0&&(n+=1);c=t.version,t=null}function l(e){return parseInt(e,10)===e}var h=function(){var e=2091639*i+2.3283064365386963e-10*s;return i=r,r=n,n=e-(s=0|e)};return h.fract53=function(){return h()+11102230246251565e-32*(2097152*h()|0)},h.int32=function(){return 4294967296*h()},h.cycle=function(e){(e=void 0===e?1:+e)<1&&(e=1);for(var t=0;t<e;t++)h()},h.range=function(){var e,t;return 1===arguments.length?(e=0,t=arguments[0]):(e=arguments[0],t=arguments[1]),arguments[0]>arguments[1]&&(e=arguments[1],t=arguments[0]),l(e)&&l(t)?Math.floor(h()*(t-e+1))+e:h()*(t-e)+e},h.restart=function(){d(a)},h.seed=function(){d(Array.prototype.slice.call(arguments))},h.version=function(){return t},h.versions=function(){return t+", "+c},0===e.length&&(window.crypto.getRandomValues(o),e=[o[0],o[1],o[2]]),a=e,d(e),h}(Array.prototype.slice.call(arguments))}(e),o=window.Function("v","rand",`"use strict";\n${t};\nreturn v;`)({divid:r,prepareCheckAnswers:s},a);let c;if("function"==typeof o.beforeContentRender)try{o.beforeContentRender(o)}catch(e){throw console.log(`Error in problem ${r} invoking beforeContentRender`),e}try{c=n(i,o)}catch(e){throw console.log(`Error rendering problem ${r} text using EJS`),e}return[c,o]}(this.seed,this.dyn_vars,this.descriptionDiv.origInnerHTML,this.divid,this.prepareCheckAnswers.bind(this)),this.descriptionDiv.replaceChildren(...e),"function"==typeof this.dyn_vars_eval.afterContentRender)try{this.dyn_vars_eval.afterContentRender(this.dyn_vars_eval)}catch(e){throw console.log(`Error in problem ${this.divid} invoking afterContentRender`),e}this.queueMathJax(this.descriptionDiv),this.setupBlanks()}}setupBlanks(){const e=$(this.descriptionDiv).find(":input");e.attr("class","form form-control selectwidthauto"),e.attr("aria-label","input area"),this.blankArray=e.toArray();for(let e of this.blankArray)$(e).change(this.recordAnswered.bind(this))}recordAnswered(){this.isAnswered=!0}restoreAnswers(e){var t;this.seed=e.seed,this.renderDynamicContent();try{if(t=JSON.parse(e.answer),!Array.isArray(t))throw new Error}catch(i){t=(e.answer||"").split(",")}let i=!1;for(var r=0;r<this.blankArray.length;r++)$(this.blankArray[r]).attr("value",t[r]),t[r]&&(i=!0);this.feedbackArray?i&&this.checkCurrentAnswer():(this.displayFeed=e.displayFeed,this.correct=e.correct,this.isCorrectArray=e.isCorrectArray,void 0!==this.displayFeed&&void 0!==this.correct&&void 0!==this.isCorrectArray&&this.renderFeedback(),this.problemHtml=e.problemHtml,this.problemHtml&&(this.descriptionDiv.innerHTML=this.problemHtml,this.queueMathJax(this.descriptionDiv),this.setupBlanks()))}checkLocalStorage(){var e;if(!this.graderactive&&localStorage.length>0){var t=localStorage.getItem(this.localStorageKey());if(null!==t){try{(e=JSON.parse(t)).answer}catch(e){return console.log(e.message),void localStorage.removeItem(this.localStorageKey())}this.restoreAnswers(e)}}}setLocalStorage(e){let t=this.localStorageKey();localStorage.setItem(t,JSON.stringify(e))}checkCurrentAnswer(){this.isCorrectArray=[],this.displayFeed=[];const e=this.prepareCheckAnswers();this.useRunestoneServices&&eBookConfig.enableCompareMe&&this.enableCompareButton(),this.feedbackArray&&([this.displayFeed,this.correct,this.isCorrectArray,this.percent]=function(e,t,i,r){if(r&&"function"==typeof r.beforeCheckAnswers){const[i,n]=s(e,t,r),a=Object.assign({},r,i);try{r.beforeCheckAnswers(a,n)}catch(e){throw console.log("Error calling beforeCheckAnswers"),e}}let n=!0;const a=[],o=[];for(let c=0;c<t.length;c++){const d=t[c];if(""===d)a.push(null),o.push("No answer provided."),n=!1;else{const l=i[c]||[];let h;for(h=0;h<l.length;h++){if(h===l.length-1){o.push(l[h].feedback);break}if(r){const[i,n]=s(e,t,r);if(n[c]instanceof TypeError){o.push(n[c].message),h=1;break}const a=window.Function("ans","ans_array",...Object.keys(r),...Object.keys(i),`"use strict;"\nreturn ${l[h].solution_code};`)(n[c],n,...Object.values(r),...Object.values(i));if(a){o.push("string"==typeof a?a:l[h].feedback);break}}else if("regex"in l[h]){if(RegExp(l[h].regex,l[h].regexFlags).test(d)){o.push(l[h].feedback);break}}else{console.assert("number"in l[h]);const[e,t]=l[h].number,i=+d;if(i>=e&&i<=t){o.push(l[h].feedback);break}}}const u=0===h&&l.length>1;a.push(u),u||(n=!1)}}if(r&&"function"==typeof r.afterCheckAnswers){const[i,n]=s(e,t,r),a=Object.assign({},r,i);try{r.afterCheckAnswers(a,n)}catch(e){throw console.log("Error calling afterCheckAnswers"),e}}const c=a.filter(Boolean).length/a.length;return[o,n,a,c]}(...e),this.isTimed||this.renderFeedback())}prepareCheckAnswers(){this.given_arr=[];for(var e=0;e<this.blankArray.length;e++)this.given_arr.push(this.blankArray[e].value);return[this.blankNames,this.given_arr,this.feedbackArray,this.dyn_vars_eval]}async randomize(){if(this.feedbackArray)this.seed=Math.floor(Math.random()*2**32),this.renderDynamicContent();else{const e=new Request("/assessment/results",{method:"POST",body:JSON.stringify({div_id:this.divid,course:eBookConfig.course,event:"fillb",sid:this.sid,new_seed:!0}),headers:this.jsonHeaders}),t=await fetch(e);if(!t.ok)return void alert(`HTTP error getting results: ${t.statusText}`);const i=(await t.json()).detail;this.seed=i.seed,this.descriptionDiv.innerHTML=i.problemHtml,this.queueMathJax(this.descriptionDiv),this.setupBlanks()}this.given_arr=Array(this.blankArray.len).fill(""),$(this.blankArray).attr("value",""),this.clearFeedbackDiv(),this.saveAnswersLocallyOnly()}saveAnswersLocallyOnly(){this.setLocalStorage({seed:this.seed,answer:JSON.stringify(this.given_arr),timestamp:new Date,problemHtml:this.descriptionDiv.innerHTML})}async logCurrentAnswer(e){let t=JSON.stringify(this.given_arr),i=!0;this.saveAnswersLocallyOnly();const r={event:"fillb",div_id:this.divid,act:t||"",seed:this.seed,answer:t||"",correct:this.correct?"T":"F",percent:this.percent};void 0!==e&&(r.sid=e,i=!1);const n=await this.logBookEvent(r);if(!i)return;if(this.feedbackArray||!n)return r;const s=n.detail;return this.timestamp=s.timestamp,this.displayFeed=s.displayFeed,this.correct=s.correct,this.isCorrectArray=s.isCorrectArray,this.setLocalStorage({seed:this.seed,answer:t,timestamp:this.timestamp,problemHtml:this.descriptionDiv.innerHTML,displayFeed:this.displayFeed,correct:this.correct,isCorrectArray:this.isCorrectArray}),this.renderFeedback(),n}renderFeedback(){if(this.correct){$(this.feedBackDiv).attr("class","alert alert-info");for(let e=0;e<this.blankArray.length;e++)$(this.blankArray[e]).removeClass("input-validation-error")}else{null===this.displayFeed&&(this.displayFeed="");for(let e=0;e<this.blankArray.length;e++)!0!==this.isCorrectArray[e]?$(this.blankArray[e]).addClass("input-validation-error"):$(this.blankArray[e]).removeClass("input-validation-error");$(this.feedBackDiv).attr("class","alert alert-danger")}for(var e="<ul>",t=0;t<this.displayFeed.length;t++){let i=this.displayFeed[t];"string"==typeof this.dyn_vars&&(i=a(this.blankNames,this.given_arr,t,i,this.dyn_vars_eval),i=i?i[0].parentElement.innerHTML:"No feedback provided"),e+=`<li>${i}</li>`}e+="</ul>",1==this.displayFeed.length&&(e=e.slice("<ul><li>".length,-"</li></ul>".length)),this.feedBackDiv.innerHTML=e,this.queueMathJax(this.feedBackDiv)}enableCompareButton(){this.compareButton.disabled=!1}compareFITBAnswers(){var e={};e.div_id=this.divid,e.course=eBookConfig.course,jQuery.get(`${eBookConfig.new_server_prefix}/assessment/gettop10Answers`,e,this.compareFITB)}compareFITB(e,t,i){var r=e.detail.res,n=(e.detail.miscdata,"<table>");for(var s in n+="<tr><th>Answer</th><th>Count</th></tr>",r)n+="<tr><td>"+r[s].answer+"</td><td>"+r[s].count+" times</td></tr>";n+="</table>",$("<div class='modal fade'>    <div class='modal-dialog compare-modal'>        <div class='modal-content'>            <div class='modal-header'>                <button type='button' class='close' data-dismiss='modal' aria-hidden='true'>&times;</button>                <h4 class='modal-title'>Top Answers</h4>            </div>            <div class='modal-body'>"+n+"            </div>        </div>    </div></div>").modal()}disableInteraction(){for(var e=0;e<this.blankArray.length;e++)this.blankArray[e].disabled=!0}}$(document).on("runestone:login-complete",(function(){$("[data-component=fillintheblank]").each((function(e){var t={orig:this,useRunestoneServices:eBookConfig.useRunestoneServices};if(0==$(this).closest("[data-component=timedAssessment]").length)try{l[this.id]=new h(t)}catch(e){console.log(`Error rendering Fill in the Blank Problem ${this.id}\n                     Details: ${e}`)}}))}));class u extends h{constructor(e){super(e),this.renderTimedIcon(this.inputDiv),this.hideButtons(),this.needsReinitialization=!0}hideButtons(){$(this.submitButton).hide(),$(this.compareButton).hide()}renderTimedIcon(e){var t=document.createElement("div"),i=document.createElement("img");$(i).attr({src:"../_static/clock.png",style:"width:15px;height:15px"}),t.className="timeTip",t.title="",t.appendChild(i),$(e).prepend(t)}checkCorrectTimed(){switch(this.correct){case!0:return"T";case!1:return"F";default:return null}}hideFeedback(){for(var e=0;e<this.blankArray.length;e++)$(this.blankArray[e]).removeClass("input-validation-error");this.feedBackDiv.style.display="none"}reinitializeListeners(){this.setupBlanks()}}void 0===window.component_factory&&(window.component_factory={}),window.component_factory.fillintheblank=function(e){return e.timed?new u(e):new h(e)}}}]);
//# sourceMappingURL=495.d49c8adcdaa5c060.bundle.js.map